## Typescript å¼€å‘ç¯å¢ƒçš„æœ€ä½³å®è·µ

**0ï¸âƒ£ git initï¼ˆç•¥ï¼‰**

**1ï¸âƒ£ï¸ï¸ åˆå§‹åŒ–ï¼š**` $ yarn add -D ts-node typescript  `

**2ï¸âƒ£ ç”Ÿæˆ tsconfig.jsonï¼š**` $ yarn tsc -init  `

**3ï¸âƒ£ é…ç½® TSLintï¼š**` $ yarn add tslint -D  `

**4ï¸âƒ£ ç”Ÿæˆ tslint.jsonï¼š**` $ yarn tslint --init  `

**5ï¸âƒ£ åˆ›å»º src/index.tsï¼š**`$ mkdir src && echo "console.log('Hello Typescript')" > src/index.ts`

**6ï¸âƒ£ æ‰§è¡Œ .ts æ–‡ä»¶ï¼š**` $ yarn ts-node src/index.ts `

**7ï¸âƒ£ å®‰è£… huskyï¼ˆæ²¡é”™ï¼Œå°±æ˜¯äºŒå“ˆğŸ•ï¼Œå“ˆå£«å¥‡ğŸ•ï¼‰ï¼š** ` $ yarn add husky -D`

**8ï¸âƒ£ æ‰“å¼€ package.jsonï¼Œæ·»åŠ  husky çš„ hookï¼š** æ¯æ¬¡æäº¤ä»£ç å‰ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡TSLintçš„æ£€æŸ¥å‘½ä»¤ã€‚
```json
{
    "husky": {
        "pre-commit": "yarn tslint -c tslint.json './**/*.ts'"
    }
}
```

**9ï¸âƒ£ å®‰è£…å‘½ä»¤è¡Œäº¤äº’ç¥å™¨ commander.jsï¼š** `$ yarn add commander`

```Typescript
const commander = require('commander');
const pkg = require('../package.json');

commander
  .version(pkg.version)
  .description(pkg.description)
  .usage('[options] <command> [...]')
  .option('-c, --city [name]', 'Add city name')
  .parse(process.argv);

if (process.argv.slice(2).length === 0) {
    commander.help();
    process.exit()
}
```

**1ï¸âƒ£0ï¸âƒ£ æµ‹è¯•å‘½ä»¤ï¼š** `$ yarn ts-node src/index.ts -h`

```bash
$ yarn ts-node src/index.ts -h
yarn run v1.10.1
$ C:\Users\Lee\Desktop\ts-weather\node_modules\.bin\ts-node src/index.ts -h
Usage: index.ts [options] <command> [...]

Options:
  -V, --version  output the version number
  -c, --city     Add city name
  -h, --help     output usage information
Done in 1.91s.
```

**1ï¸âƒ£1ï¸âƒ£ è·å–å‘½ä»¤è¡Œè¾“å…¥ï¼š**`$ yarn ts-node src/index.ts --city dongguan`
```Typescript
console.log(commander.city) // => dongguan
```


**1ï¸âƒ£2ï¸âƒ£ æ·»åŠ å‘½ä»¤è¡Œé¢œè‰²**ï¼š `$ yarn add colors`
```Typescript
const colors = require('colors');
const commander = require('commander');
const pkg = require('../package.json');

commander
  .version(pkg.version)
  .description(pkg.description)
  .usage('[options] <command> [...]')
  .option('-c, --city [name]', 'Add city name')
  .parse(process.argv);

if (process.argv.slice(2).length === 0) {
    commander.outputHelp(colors.red);
    process.exit()
}
```

**1ï¸âƒ£3ï¸âƒ£ é«˜å¾·å¤©æ°”é¢„æŠ¥ - æ¥å£æ–‡æ¡£ï¼š** 

https://lbs.amap.com/api/webservice/guide/api/weatherinfo

1. å…ˆç”³è¯·é«˜å¾·å¼€å‘è€…è´¦å·ï¼Œç„¶åå¼€é€šã€å¤©æ°”æ¥å£apiã€çš„æœåŠ¡ï¼Œé‡ç‚¹æ‹¿åˆ°ã€keyã€ï¼›
2. ä»”ç»†é˜…è¯»æ¥å£æ–‡æ¡£ï¼›
3. å¯ä»¥å…ˆåœ¨æµè§ˆå™¨ä¸­æµ‹è¯•è¯·æ±‚æ˜¯å¦æ­£å¸¸ï¼›

è¯·æ±‚å‚æ•°ï¼š

<table><tbody><tr><th colspan="2"><p>å‚æ•°å</p></th><th><p>å«ä¹‰</p></th><th><p>è§„åˆ™è¯´æ˜</p></th><th><p>æ˜¯å¦å¿…é¡»</p></th><th><p>ç¼ºçœå€¼</p></th></tr><tr><td colspan="2" style="white-space: nowrap;"><p>key</p></td><td><p>è¯·æ±‚æœåŠ¡æƒé™æ ‡è¯†</p></td><td><p>ç”¨æˆ·åœ¨é«˜å¾·åœ°å›¾å®˜ç½‘<a href="https://lbs.amap.com/dev/" class="" target="_blank">ç”³è¯·webæœåŠ¡APIç±»å‹KEY</a></p></td><td><p>å¿…å¡«</p></td><td><p>æ— </p></td></tr><tr><td colspan="2" style="white-space: nowrap;"><p>city</p></td><td><p>åŸå¸‚ç¼–ç </p></td><td><p>è¾“å…¥åŸå¸‚çš„adcodeï¼Œadcodeä¿¡æ¯å¯å‚è€ƒ<a href="https://lbs.amap.com/api/webservice/download" class="" target="_blank">åŸå¸‚ç¼–ç è¡¨</a></p></td><td><p>å¿…å¡«</p></td><td><p>æ— </p></td></tr><tr><td colspan="2" style="white-space: nowrap;"><p>extensions</p></td><td><p>æ°”è±¡ç±»å‹</p></td><td><p>å¯é€‰å€¼ï¼šbase/all</p><p>base:è¿”å›å®å†µå¤©æ°”</p><p>all:è¿”å›é¢„æŠ¥å¤©æ°”</p></td><td><p>å¯é€‰</p></td><td><p>æ— </p></td></tr><tr><td colspan="2" style="white-space: nowrap;"><p>output</p></td><td><p>è¿”å›æ ¼å¼</p></td><td><p>å¯é€‰å€¼ï¼šJSON,XML</p></td><td><p>å¯é€‰</p></td><td><p>JSON</p></td></tr></tbody></table>

##### è¯·æ±‚ç¤ºä¾‹ï¼š

> https://restapi.amap.com/v3/weather/weatherInfo?key=9f1c132e77dc10edf34fe44bec1208a9&city=ä¸œè

è¿”å›ç»“æœï¼š

```json
{status: "1", count: "1", info: "OK", infocode: "10000", lives: [{province: "å¹¿ä¸œ", city: "ä¸œèå¸‚", adcode: "441900", weather: "å°é›¨", temperature: "27", winddirection: "è¥¿å—", windpower: "â‰¤3", humidity: "78", reporttime: "2019-05-26 18:13:57"}]}
```

**1ï¸âƒ£4ï¸âƒ£æ ¹æ®è¿™ä¸ª JSON å®šåˆ¶ä¸€ä¸ª interface**

```Typescript
interface IWeaterResponse {
    status: string,
    count: string,
    info: string,
    infocode: string,
    lives: ILive[],
}

interface ILive {
    province: string,
    city: string,
    adcode: string,
    weather: string,
    temperature: string,
    winddirection: string,
    windpower: string,
    humidity: string,
    reporttime: string,
}

// test demo
let a:IWeaterResponse = {status: "1", count: "1", info: "OK", infocode: "10000", lives: [{province: "å¹¿ä¸œ", city: "ä¸œèå¸‚", adcode: "441900", weather: "å°é›¨", temperature: "27", winddirection: "è¥¿å—", windpower: "â‰¤3", humidity: "78", reporttime: "2019-05-26 18:13:57"}] }

// normal output
console.log(a)
```

**1ï¸âƒ£5ï¸âƒ£å¼•å…¥æœ€æµè¡Œçš„ axios æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼š**`$ yarn add axios`

```Typescript
import axios, { AxiosResponse } from 'axios'
const colors = require('colors')
const commander = require('commander')
const pkg = require('../package.json')

const { log } = console
const __URL__ = "https://restapi.amap.com/v3/weather/weatherInfo"
const __KEY__ = "9f1c132e77dc10edf34fe44bec1208a9"

commander
  .version(pkg.version)
  .description(pkg.description)
  .usage('[options] <command> [...]')
  .option('-c, --city [name]', 'Add city name')
  .parse(process.argv);

if (process.argv.slice(2).length === 0) {
    commander.outputHelp(colors.red)
    process.exit()
}

interface IWeaterResponse {
    status: string,
    count: string,
    info: string,
    infocode: string,
    lives: ILive[],
}

interface ILive {
    province: string,
    city: string,
    adcode: string,
    weather: string,
    temperature: string,
    winddirection: string,
    windpower: string,
    humidity: string,
    reporttime: string,
}

axios.get(`${__URL__}?city=${encodeURI(commander.city)}&key=${__KEY__}`).then((res: AxiosResponse<IWeaterResponse>) => {
    const live = res.data.lives[0]
    log(colors.yellow(live.reporttime));
    log(colors.white(`${live.province} ${live.city}`));
    log(colors.blue(`${live.weather} ${live.temperature} Â°`));
}).catch((err: Error) => {
    log(colors.red("å¤©æ°”æœåŠ¡æ¥å£å¼‚å¸¸ï¼" + err.message))
})
```

æµ‹è¯•ä¸€ä¸‹ï¼š `$ yarn ts-node src/index.ts --city ä¸œè`

```bash
2019-05-26 19:43:57
å¹¿ä¸œ ä¸œèå¸‚
å°é›¨ 26 Â°
```